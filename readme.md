# Okta IDP loader

This project is designed to do idp-related load testing in Okta tenants. The load testing is meant to answer a couple of questions:

* Is there a practical limit to the number of IDPs that an Okta RP can contain?

* At what point (if any) does the routing rule lookup process impede the user login experience?

This experiment was motivated by a customer who asked if an Okta tenant could handle 500k IDPs and associated routing rules.

## How it works

I have set up one okta tenant as an OIDC IDP, and another okta tenant as an RP.

This script creates x number of OIDC IDPs in the RP. Each of these IDPs is actually the same Okta OIDC IDP tenant, but with a different name. The uniqueness of the name is ensured by creating a random string (a "domain") as part of the name. 

When the script creates a new IDP in the RP, it also creates an associated new user (based on the domain) in the IDP and an associated routing rule in the RP based on the domain.

### Example

new IDP name (generated by script): 42-mfmtyqju
IDP id (generated by Okta): 0oa123kyp4sL5BRak357
new user in IDP: lois.lane@mfmtyqju.com
routing rule in RP: if domain == mfmtyqju.com then route user to 0oa123kyp4sL5BRak357

## Logging

Every new IDP is logged to a dynamodb instance that records the idp id, the name, the index (count), and the time it took for the IDP creation API call to execute.

## Configuration

In the config.json file, update the following values:
```
	"okta_rp_domain": "https://dev-705939.okta.com",
	"okta_idp_domain": "https://okta-oidc-idp.okta.com",
	"okta_rp_idp_disco_policy_id": "00p123jj6diOtFm31357",
	"client_id": "0oa11dhbcpKBSVyzy357"
```

Note: the okta_rp_idp_disco_policy_id is the id of the default IDP discovery policy for the RP. It's not well documented, but you can retrieve the policy id with this API call:

```
GET
{{url}}/api/v1/policies?type=IDP_DISCOVERY
```

Note: the client_id is the client_id of the OIDC client created in the IDP. It is the same for all of the IDPs that are set up in the RP.

In the secrets.json file, update the following values:

```
	"okta_rp_api_key": "",
	"okta_idp_api_key": "",
	"client_secret": "",
	"fake_user_password": ""
```

Note: the client_secret is the client_secret of the OIDC client created in the IDP. It is the same for all of the IDPs that are set up in the RP.

Note: choose a fake user password that fits the default Okta password policy (unless you've changed it:

At least 8 character(s)

At least 1 number(s)

At least 1 lowercase letter(s)

At least 1 uppercase letter(s)

Does not contain part of username
